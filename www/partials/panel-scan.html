<div class="panel panel-default">
    <div class="panel-heading"
        ng-click='onMore("moreScan")' 
        title="Scan region of interest in DeltaMesh to gather data for interpolation" >
        <h3 class="panel-title">
            Scan <a href=https://github.com/firepick1/firenodejs/wiki/REST-mesh target=_blank>
                <samp>/mesh</samp></a> 
            <span ng-class="availableIcon(mesh.isAvailable())"></span>
        </h3> 
    </div><!--panel-heading-->
    <div class="panel-body" ng-if="flags.moreScan">
        <div class="row">
            <div class="col-sm-2">
                <button class="btn btn-primary fn-column-button" ng-click='mesh.create()'
                    title="Create calibration scanning mesh">
                    Create Mesh</button>
                <button class="btn btn-primary fn-column-button" ng-click='mesh.create()' ng-disabled="true"
                    title="Scan region of interest and measure selected properties">
                    Scan</button>
            </div> <!-- col -->
            <div class="col-sm-5">
                <div style="height:400px; width:400px">
                    <svg class="" width="100%" height="100%">
                        <g ng-attr-opacity="{{camera.reticle.opacity}}" ng-attr-stroke="{{'grey'}}" 
                            transform="translate(200,200) scale(-1,1)"
                            stroke-width="1">
                            <!--scanning ROI-->
                            <rect ng-if="mesh.model.roi.type === 'rect'"
                                ng-attr-x="{{mesh.model.roi.cx-mesh.model.roi.width/2}}" 
                                ng-attr-y="{{mesh.model.roi.cy-mesh.model.roi.height/2}}" 
                                ng-attr-width="{{mesh.model.roi.width}}"
                                ng-attr-height="{{mesh.model.roi.height}}"
                                rx="10" ry="10"
                                stroke-dasharray="2,2"
                                ng-attr-stroke="{{mesh.color.activeScan}}" fill="none" />
                            <!--axes-->
                            <line x1="-200" y1="0" x2="200" y2="0" />
                            <line x1="0" y1="-200" x2="0" y2="200" />
                            <!--vertices-->
                            <g ng-if="mesh.vertices && mesh.vertices.length">
                                <circle ng-repeat="v in mesh.vertices" 
                                    ng-attr-cx="{{v.x}}", ng-attr-cy="{{v.y}}" 
                                    ng-attr-r="{{mesh.vertexRadius(v)}}" 
                                    ng-attr-stroke="{{mesh.vertexColor(v)}}" 
                                    fill="none"/>
                             </g>
                         </g>
                    </svg>
                </div> <!-- svg -->
            </div> <!-- col -->
        </div> <!-- row -->

        <div class="fr-more" ng-if="!flags.moreMesh" ng-click='onMore("moreMesh")' >more...</div>
        <div class="fr-more" ng-if="flags.moreMesh" ng-click='onMore("moreMesh")' >less...</div>
            <table ng-if="flags.moreMesh" class="table table-condensed table-striped">
                <tr class="row" ng-if="mesh.mesh"
                    title="Include all vertices up to given maximum mesh refinement level">
                    <th class="col-sm-2 fn-row-label">
                        Scan Density
                    </th>
                    <td class="col-sm-8">
                        <form class="form-inline">
                            <div class="form-group" title="Maximum mesh refinement level to include in scans">
                                <div class="radio" ng-repeat="lvl in mesh.levels">
                                    <label>
                                        <input type="radio" ng-model="mesh.model.maxLevel" 
                                            ng-change="mesh.onChangeLevel()" ng-value="lvl">{{lvl}}&nbsp;&nbsp;
                                   </label>
                                </div>
                            </div>
                        </form>
                    </div> <!-- col -->
                </tr> 
                <tr class="row" ng-if="mesh.mesh" title="Select properties to measure in the scanning region of interest">
                    <th class="col-sm-2 fn-row-label">
                        Scan Properties
                    </th>
                    <td class="col-sm-8">
                        <form class="form-inline">
                            <div class="form-group" >
                                <div class="checkbox" ng-repeat="prop in mesh.model.properties"
                                    title="{{prop.title}} ({{prop.id}})" >
                                    <label>
                                        <input type="checkbox" ng-model="prop.selected"
                                            ng-change="mesh.onChangeProperty(prop)" ng-value="prop.id">{{prop.name}}&nbsp;&nbsp;
                                   </label>
                                </div>
                            </div>
                        </form>
                    </div> <!-- col -->
                </tr> 
                <tr class="row" ng-if="mesh.mesh">
                    <th class="col-sm-2 fn-row-label" title="Scanning region of interest (ROI) defines vertices to scan and measure">
                        Region of Interest
                        <p style="font-weight:normal"><var>{{mesh.model.roi.vertices.length}} of {{mesh.vertices.length}} vertices</var></p>
                    </th>
                    <td class="col-sm-8">
                        <form class="form-inline">
                            <div class="input-group col-sm-2">
                                <label >type</label>
                                <select class="form-control" 
                                    ng-change="mesh.validate()"
                                    ng-model="mesh.model.roi.type">
                                    <option value="">None</option>
                                    <option value="rect">Rectangle</option>
                                </select>
                            </div>
                            <div class="input-group col-sm-2" ng-if="mesh.model.roi.type === 'rect'">
                                <label >cx</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="center x-coordinate of scanning rectangle"
                                    ng-change="mesh.validate()"
                                    ng-model="mesh.model.roi.cx"></input>
                            </div>
                            <div class="input-group col-sm-2" ng-if="mesh.model.roi.type === 'rect'">
                                <label >cy</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="center y-coordinate of scanning rectangle"
                                    ng-change="mesh.validate()"
                                    ng-model="mesh.model.roi.cy"></input>
                            </div>
                            <div class="input-group col-sm-2" ng-if="mesh.model.roi.type === 'rect'">
                                <label >width</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="width of scanning rectangle"
                                    ng-change="mesh.validate()"
                                    ng-model="mesh.model.roi.width"></input>
                            </div>
                            <div class="input-group col-sm-2" ng-if="mesh.model.roi.type === 'rect'">
                                <label >height</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="height of scanning rectangle"
                                    ng-change="mesh.validate()"
                                    ng-model="mesh.model.roi.height"></input>
                            </div>
                        </form>
                    </div> <!-- col -->
                </tr> 
                <tr class="row">
                    <th class="col-sm-2 fn-row-label">
                        Mesh Type
                    </th>
                    <td class="col-sm-8">
                        <form class="form-inline">
                            <div class="form-group" title="Mesh topology">
                                <select class="form-control" ng-model="mesh.model.type">
                                    <option value="DeltaMesh">DeltaMesh (pyramid tetrahedron mesh)</option>
                                </select>
                            </div>
                        </form>
                    </div> <!-- col -->
                <tr class="row">
                    <th class="col-sm-2 fn-row-label">
                        Mesh Dimensions
                    </th>
                    <td class="col-sm-10">
                        <form class="form-inline">
                            <div class="input-group col-sm-2">
                                <label >zMin</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="Lowest calibration z-plane (nominal)"
                                    ng-model="mesh.model.zMin"></input>
                            </div>
                            <div class="input-group col-sm-2">
                                <label >zMax</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="highest mesh z-coordinate"
                                    ng-model="mesh.model.zMax"></input>
                            </div>
                            <div class="input-group col-sm-2">
                                <label >rIn</label>
                                <input class="form-control input-sm " type="number" step="any" min="0"
                                    title="Radius of circle that designates scannable mesh vertices"
                                    ng-model="mesh.model.rIn"></input>
                            </div>
                            <div class="input-group col-sm-2">
                                <label >zPlanes</label>
                                <input class="form-control input-sm " type="number" step="any" min="3" max="8"
                                    title="Number of mesh vertex z-planes"
                                    ng-model="mesh.model.zPlanes"></input>
                            </div>
                            <div class="input-group col-sm-2" ng-hide="true">
                                <label >height</label>
                                <input class="form-control input-sm " type="number" step="any"
                                    title="Z-height of root tetrahedron (leave blank for regular tetrahedron)"
                                    ng-model="mesh.model.height"></input>
                            </div>
                        </form>
                    </td> 
                </tr> 
            </table>
        </div> <!-- moreMesh -->

    </div><!--panel-body-->
</div><!--panel-->
