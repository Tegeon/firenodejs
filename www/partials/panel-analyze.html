<div class="panel panel-default">
    <div class="panel-heading"
        ng-click='onMore("moreAnalyze")' 
        title="Calculate image metrics for the selected camera at the current microstep location using FireSight&trade; OpenCV JSON pipeline">
        <h3 class="panel-title">
            Analyze <a href=https://github.com/firepick1/firenodejs/wiki/REST-firesight target=_blank>
            <samp>/firesight</samp></a> 
            <span ng-class="availableIcon(firesight.isAvailable())"></span>
        </h3> 
    </div><!--"panel-heading"-->
    <div class="panel-body" ng-if="flags.moreAnalyze">
        <div class="row">
            <div class="col-sm-2">
                <div>
                    <button class="btn btn-primary" style="width:100%; margin:0.1em"
                        title='Calculate offset from saved position'
                        ng-click='firesight.calcOffset(camera.selected)'>CalcOffset</button></td>
                </div>
                <div>
                    <button class="btn btn-primary" style="width:100%; margin:0.1em"
                        title='Calculate grid size, position and angle'
                        ng-click='firesight.calcGrid(camera.selected)'>CalcGrid</button></td>
                </div>
                <div>
                    <button class="btn btn-primary" style="width:100%; margin:0.1em"
                        title='Calculate foreground bounding rectangle after subtracting saved background image from current camera image'
                        ng-click='firesight.calcFgRect(camera.selected)'>CalcFgRect</button></td>
                </div>
                <div>
                    <button class="btn btn-primary" style="width:100%; margin:0.1em"
                        title='Read QR code(s) from current camera image'
                        ng-click='firesight.readQR(camera.selected)'>ReadQR</button></td>
                </div>
            </div>
            <div class="col-sm-4">
                <div ng-if="firesight.getResults().calcOffset"> 
                    <table class="table table-condensed table-bordered">
                        <caption><a href=https://github.com/firepick1/firenodejs/wiki/Help-CalcOffset target="_blank">Calculate Offset</a></caption>
                        <tr class="{{firesight.calcOffsetClass('dx')}}" ><th>dx</th><td>{{firesight.getResults().calcOffset.dx}}</td></tr>
                        <tr class="{{firesight.calcOffsetClass('dy')}}" ><th>dy</th><td>{{firesight.getResults().calcOffset.dy}}</td></tr>
                    </table>
                </div>
                <div ng-if="firesight.getResults().calcGrid"> 
                    <table class="table table-condensed table-bordered" ng-repeat="cg in [firesight.getResults().calcGrid]">
                        <caption><a href="https://github.com/firepick1/firenodejs/wiki/Help-CalcGrid" target="_blank" >Calculate Grid</a></caption>
                        <tr><th>&nbsp;</th><th>x</th><th>y</th></tr>
                        <tr title="Grid intersection closest to center of image"><th>origin</th>
                            <td class="{{cg.class.x}}">{{cg.origin.x}}</td>
                            <td class="{{cg.class.y}}">{{cg.origin.y}}</td> </tr>
                        <tr title="counter-clockwise degrees from image x-axis"><th>angle</th>
                            <td class="{{cg.class.xy}}" colspan=2 >{{cg.angle}}</td> </tr>
                        <tr title="average grid line separation in pixels"><th>cellSize</th>
                            <td class="{{cg.class.x}}">{{cg.cellSize.w}}</td>
                            <td class="{{cg.class.y}}">{{cg.cellSize.h}}</td>
                            </td></tr>
                        <tr title="Square root of the mean error between data points and calculated grid"><th>RMS Error</th>
                            <td class="{{cg.class.x}}">x:{{cg.rmse.x}}</td>
                            <td class="{{cg.class.y}}">y:{{cg.rmse.y}}</td> </tr>
                    </table>
                </div>
                <div ng-if="firesight.getResults().calcFgRect"> 
                    <table class="table table-condensed table-bordered">
                        <caption><a href=https://github.com/firepick1/firenodejs/wiki/Help-CalcFgRect target="_blank">Calculate Foreground Rectangle</a></caption>
                        <tr ><th>x</th><td>{{firesight.getResults().calcFgRect.x}}</td></tr>
                        <tr ><th>y</th><td>{{firesight.getResults().calcFgRect.y}}</td></tr>
                        <tr ><th>width</th><td>{{firesight.getResults().calcFgRect.width}}</td></tr>
                        <tr ><th>length</th><td>{{firesight.getResults().calcFgRect.length}}</td></tr>
                        <tr ><th>angle</th><td>{{firesight.getResults().calcFgRect.angle}}</td></tr>
                        <tr ><th>points</th><td>{{firesight.getResults().calcFgRect.points}}</td></tr>
                    </table>
                </div>
                <div ng-if="firesight.getResults().readQR"> 
                    <table class="table table-condensed table-bordered">
                        <caption><a href=https://github.com/firepick1/firenodejs/wiki/Help-ReadQR target="_blank">Read QR code</a></caption>
                        <tr ng-repeat="qr in firesight.getResults().readQR">
                            <th>QR#{{$index+1}}</th>
                            <td>
                                <b>x:</b>{{qr.x}},
                                <b>y:</b>{{qr.y}},
                                <b>text:</b>"{{qr.text}}"
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="col-sm-3" ng-repeat="cam in [camera.selected]">
                <div ng-include="'partials/image.html'" 
                    onload="img='/firesight/'+cam+'/out.jpg'" height="200px">
                </div>
            </div> <!-- col -->
        </div> <!-- row -->
    </div><!--"panel-body"-->
</div><!--"panel"-->
